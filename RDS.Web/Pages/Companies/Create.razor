@page "/empresas/adicionar"
@inherits RDS.Web.Pages.Companies.CreateCompanyPage

<AuthorizeView>
    <Authorized>
        @if (!OwnerSelected)
        {
            <MudDataGrid T="ApplicationUser" Items="@FilteredUsers" Filterable="true" Hideable="true">
                <ToolBarContent>
                        <MudTextField @bind-Value="@SearchFilter"
                                      Class="mr-4"
                                      Placeholder="Informe o proprietário da empresa"
                                      Adornment="Adornment.Start"
                                      AdornmentIcon="@Icons.Material.Filled.Search"
                                      Immediate="true"
                                      Variant="Variant.Outlined"
                                      Clearable="true"
                                      OnKeyDown="HandleKeyDown"
                                      AutoFocus/>
                        <div class="d-flex mt-2 mb-2">
                            <MudButton Class="mr-4"
                                       Variant="Variant.Filled"
                                       Color="Color.Primary"
                                       OnClick="OnSearch">
                                Buscar
                            </MudButton>
                        </div>
                        <MudSpacer/>
                </ToolBarContent>
                <Columns>
                    <PropertyColumn Class="mud-data-grid"
                                    CellClass="mud-data-grid mud-data-grid-cell"
                                    Property="x => x.Id" Title="#"/>
                    <PropertyColumn Class="mud-data-grid"
                                    CellClass="mud-data-grid mud-data-grid-cell"
                                    Property="x => x.Name" Title="Nome"/>
                    <PropertyColumn Class="mud-data-grid"
                                    CellClass="mud-data-grid mud-data-grid-cell"
                                    Property="x => x.Email" Title="Email"/>
                    <TemplateColumn Class="d-flex justify-end" Title="&nbsp;">
                        <CellTemplate Context="cellContext">
                            <MudStack Row>
                                <MudIconButton
                                    Icon="@Icons.Material.Filled.ArrowCircleRight"
                                    Color="Color.Primary"
                                    OnClick="@(() => OnSelect(cellContext.Item.Id))">
                                </MudIconButton>
                            </MudStack>
                        </CellTemplate>
                    </TemplateColumn>
                </Columns>
                <PagerContent>
                    <MudDataGridPager T="ApplicationUser"
                                      Class="custom-pager mud-typography"
                                      RowsPerPageString="Registros por página"
                                      InfoFormat="{first_item} - {last_item} de {all_items}"
                                      PageSizeOptions="new[] { 5, 10, 25, 50, 100 }"/>
                </PagerContent>
            </MudDataGrid>
        }
        else
        {
            @if (IsBusy)
            {
                <MudPaper Class="pa-8 mt-4">
                    <MudSkeleton Height="55px"/>
                    <MudSkeleton Height="110px"/>
                    <MudSkeleton Height="55px"/>
                    <MudSkeleton Height="55px"/>
                </MudPaper>
            }
            else
            {
                <MudPaper Class="pa-8 mt-4">
                    <EditForm Model="@InputModel" OnValidSubmit="OnValidSubmitAsync" Context="createContext">
                        <DataAnnotationsValidator/>

                        <MudTextField Label="Proprietário"
                                      Lines="1"
                                      @bind-Value="OwnerDisplayText"
                                      For="@(() => OwnerDisplayText)"
                                      Variant="Variant.Outlined"
                                      ReadOnly="true"/>
                        
                        <MudTextField Label="Nome"
                                      HelperText="Campo obrigatório"
                                      @bind-Value="InputModel.Name"
                                      For="@(() => InputModel.Name)"
                                      Variant="Variant.Outlined"
                                      AutoFocus/>

                        <MudTextField Label="Descrição"
                                      Lines="1"
                                      HelperText="Campo obrigatório"
                                      @bind-Value="InputModel.Description"
                                      For="@(() => InputModel.Description)"
                                      Variant="Variant.Outlined"/>
                        
                        <SaveAndCancelButtons CancelPage="/empresas"/>
                    </EditForm>
                </MudPaper>
            }
        }
    </Authorized>
    <NotAuthorized>
        @(async () => await NavigationService.NavigateToAccessNotAllowedAsync())
    </NotAuthorized>
</AuthorizeView>